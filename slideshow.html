<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DJ Visualizer - Concluintes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #000;
            overflow: hidden;
            margin: 0;
        }

        /* --- BACKGROUND EFFECTS (Video) --- */
        /* CSS Backgrounds removed in favor of <video> element */

        /* --- TEXT STYLING --- */
        .title-container {
            position: absolute;
            top: 5%;
            left: 0;
            width: 100%;
            text-center: center;
            z-index: 20;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .neon-title {
            font-size: 7rem;
            font-weight: 900;
            font-style: italic;
            color: #fff;
            text-transform: uppercase;
            line-height: 1;
            letter-spacing: -2px;
            /* Multi-color glow to match background */
            text-shadow:
                0 0 10px #fff,
                0 0 20px #fff,
                0 0 40px #2563eb,
                /* Blue */
                0 0 70px #4c1d95,
                /* Purple */
                0 0 100px #4c1d95;
            animation: pulse-text 2s infinite alternate;
        }

        @keyframes pulse-text {
            0% {
                opacity: 0.9;
                transform: scale(1);
            }

            100% {
                opacity: 1;
                transform: scale(1.02);
                text-shadow: 0 0 20px #fff, 0 0 50px #2563eb, 0 0 90px #4c1d95;
            }
        }

        .subtitle {
            font-size: 1.5rem;
            letter-spacing: 0.8em;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 10px;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
        }

        /* --- PHOTO CONTAINER --- */
        .slide-container {
            position: absolute;
            top: 55%;
            /* Adjusted to center better with larger size */
            left: 50%;
            transform: translate(-50%, -50%);
            width: 95vh;
            /* Increased from 80vh */
            height: 80vh;
            /* Increased from 65vh */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .photo-frame {
            max-width: 100%;
            max-height: 100%;
            /* MATCHING TITLE STYLE (White + Blue/Purple Glow) */
            border: 4px solid #fff;
            box-shadow:
                0 0 15px #fff,
                0 0 30px #2563eb,
                /* Blue */
                0 0 60px #4c1d95;
            /* Purple */
            animation: pulse-border 2s infinite alternate;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        @keyframes pulse-border {
            0% {
                box-shadow: 0 0 15px #fff, 0 0 30px #2563eb, 0 0 60px #4c1d95;
            }

            100% {
                box-shadow: 0 0 25px #fff, 0 0 50px #2563eb, 0 0 90px #4c1d95;
            }
        }

        /* Animation Classes */
        .fx-enter {
            animation: zoomIn 0.8s cubic-bezier(0.22, 1, 0.36, 1) both;
        }

        @keyframes zoomIn {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Counter */
        .counter-box {
            position: absolute;
            bottom: 20px;
            right: 20px;
            color: #fff;
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            font-size: 1.2rem;
            z-index: 30;
            opacity: 0.6;
            text-shadow: 0 0 5px #000;
        }
    </style>
</head>

<body class="bg-black text-white">

    <!-- Video Background -->
    <video id="bg-video" class="absolute inset-0 w-full h-full object-cover z-0" autoplay muted playsinline></video>
    <!-- Overlay removed as requested -->

    <!-- Header -->
    <div class="title-container">
        <h1 class="neon-title">CONCLUINTES</h1>
        <p class="subtitle">ELIEL PEIXOTO 2025</p>
    </div>

    <!-- Photo Area -->
    <div class="slide-container">
        <img id="current-photo" src="" class="photo-frame object-contain" alt="DJ Visualizer">
    </div>

    <!-- Discreet Counter -->
    <div class="counter-box">
        <i class="fas fa-camera"></i> <span id="photo-count">0</span>
    </div>

    <!-- Loading -->
    <div id="loading" class="absolute inset-0 z-50 flex items-center justify-center bg-black">
        <h2 class="text-4xl font-black text-purple-500 animate-pulse tracking-widest">CARREGANDO...</h2>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, query, orderBy, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- VIDEO PLAYLIST LOGIC ---
        const videoPlayer = document.getElementById('bg-video');
        // You can add more files here: 'video/04.mp4', etc.
        const playlist = [
            'video/01.mp4',
            'video/02.mp4',
            'video/03.mp4',
            'video/04.mp4',
            'video/05.mp4'
        ];
        let currentVideoIndex = 0;

        function playNextVideo() {
            // Check if file exists is hard on client-side without server check, 
            // so we assume user provides valid files or we handle error.
            videoPlayer.src = playlist[currentVideoIndex];
            videoPlayer.play().catch(e => console.log("Video play error (interaction needed?):", e));

            currentVideoIndex = (currentVideoIndex + 1) % playlist.length;
        }

        // When video ends, play next
        videoPlayer.addEventListener('ended', playNextVideo);

        // Handle error (e.g., file not found) -> skip to next
        videoPlayer.addEventListener('error', () => {
            console.warn(`Video ${playlist[currentVideoIndex]} not found or error. Skipping.`);
            // Try next one immediately
            // Note: currentVideoIndex was already incremented in playNextVideo, 
            // but if src assignment failed, we need to move on.
            // Let's just call playNextVideo again.
            // To prevent infinite loop if NO videos exist, we could add a safety check, 
            // but for now simple skip is fine.
            setTimeout(playNextVideo, 1000);
        });

        // Start playing
        playNextVideo();

        // --- FIREBASE & SLIDESHOW LOGIC ---
        const firebaseConfig = {
            apiKey: "AIzaSyC-GQSHcVoUL-3vNjQ9nhj9-BmqVjIPYDM",
            authDomain: "app-conclusao.firebaseapp.com",
            projectId: "app-conclusao",
            storageBucket: "app-conclusao.firebasestorage.app",
            messagingSenderId: "1033654845814",
            appId: "1:1033654845814:web:dbe2fcb15e655fc7413a57"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let photos = [];
        let currentIndex = 0;
        const photoEl = document.getElementById('current-photo');
        const loadingEl = document.getElementById('loading');
        const countEl = document.getElementById('photo-count');

        // Listen for photos
        const q = query(collection(db, "party_gallery"), orderBy("timestamp", "desc"), limit(50));

        onSnapshot(q, (snapshot) => {
            const newPhotos = [];
            snapshot.forEach(doc => {
                newPhotos.push(doc.data().image);
            });

            // Flash on new photo
            if (newPhotos.length > 0 && photos.length > 0 && newPhotos[0] !== photos[0]) {
                triggerFlash();
            }

            photos = newPhotos;
            countEl.innerText = photos.length;

            if (photos.length > 0 && loadingEl) {
                loadingEl.classList.add('hidden');
                if (!photoEl.src || photoEl.src === window.location.href) showPhoto(0);
            }
        });

        function showPhoto(index) {
            if (photos.length === 0) return;

            // Reset
            photoEl.style.opacity = 0;
            photoEl.classList.remove('fx-enter');

            setTimeout(() => {
                photoEl.src = photos[index];
                photoEl.onload = () => {
                    photoEl.classList.add('fx-enter');
                    photoEl.style.opacity = 1;
                };
            }, 300);
        }

        function triggerFlash() {
            const flash = document.createElement('div');
            flash.className = 'absolute inset-0 bg-white z-50 pointer-events-none mix-blend-overlay';
            document.body.appendChild(flash);

            flash.animate([
                { opacity: 1 },
                { opacity: 0 }
            ], { duration: 300 }).onfinish = () => flash.remove();

            currentIndex = 0;
            showPhoto(0);
        }

        // Cycle
        setInterval(() => {
            if (photos.length > 0) {
                currentIndex = (currentIndex + 1) % photos.length;
                showPhoto(currentIndex);
            }
        }, 5000);

    </script>
</body>

</html>